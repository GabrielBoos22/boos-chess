<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/pesquisa2.css">
    <!-- <link rel="stylesheet" href="./css/formulario-estilo.css"> -->
    <link rel="stylesheet" href="./css/pesquisa.css">

</head>

<body>

    <div class="header">
        <div class="container">
            <ul class="navBar">
                <li><a class="navbar-link" href="cadastro.html"><img class="imagem-lupa" src="imgs/pesquisar.png"></a>
                </li>
                <!-- <li><a href="">Sobre Nós</a></li> -->
                <li><a class="navbar-link" href="aulas.html">Aulas</a></li>
                <li><a class="navbar-link" href="quiz.html">Quiz</a></li>
                <li><a class="navbar-link" href="./index.html">
                        <h1 class="titulo"><img src="imgs/logotipo.png"></h1>
                    </a></li>
                <li><a class="navbar-link" href="duvida.html">Fale Conosco</a></li>
                <li><a href="login.html"><img src="imgs/sair.png" alt="sair"></a></li>
            </ul>
        </div>
    </div>

    <div class="banner pesquisa">
        <div class="formulario pesquisa">
            <input id="input_user" placeholder="procurar por email, nome ou nome de usuário">
            <button class="botao-pesquisa" onclick="pesquisar()">Pesquisar</button>
            <div class="alerta_erro">
                <div class="card_erro" id="cardErro">
                    <span id="mensagem_erro"></span>
                </div>
            </div>
            <div id="usuario_achado">

            </div>
        </div>

    </div>



    <div class="footer">
        <div class="container">
            <h4> Copyright by BoosChess &copy; 2023</h4>
            <span class="version">v1.0.0</span>
        </div>
    </div>

</body>

</html>
</body>

</html>
<script>

    function pegarId(a) {
        console.log(a)
        console.log(a.value)
        sessionStorage.setItem('ID_PESQUISADO',a.value)
        // setTimeout(function () {
        //     window.location = "./relatorioUsuario.html";
        // }, 1000); // apenas para exibir o loading
    }

    function pesquisar() {
        var usuario = input_user.value;
        console.log(usuario)
        if (usuario == '') {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "O campos precisam ser preenchidos";
        } else {
            fetch(`/usuarios/pesquisar/${usuario}`).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);


                        if (json.length > 1) {

                            for (var i = 0; i < json.length; i++) {
                                if (i == 1) {
                                    usuario_achado.innerHTML = `<p><a value='${json[1].idUsuario}' onclick="pegarId(this)" ><img src='imgs/usuario-icon.png'> ${json[i].username}</a></p> `
                                } else {
                                    usuario_achado.innerHTML += `<p><a href='relatorioUsuario.html'><img src='imgs/usuario-icon.png'> ${json[i].username}</a></p> `
                                }
                                console.log("é maior que 1")
                            }

                        } else {
                            console.log("é menor ou igual a 1")
                            console.log(json)
                            var id = json[0].idUsuario
                            sessionStorage.setItem('ID_PESQUISADO', id)
                            usuario_achado.innerHTML = `<p><a><img src='imgs/usuario-icon.png'> ${json[0].username}</a></p>`
                             setTimeout(function () {
                            window.location = "./relatorioUsuario.html";
                        }, 1000); // apenas para exibir o loading

                        }
                        // sessionStorage.EMAIL_USUARIO = json.email;
                        // sessionStorage.NOME_USUARIO = json.nome;
                        // sessionStorage.ID_USUARIO = json.idUsuario;

                        cardErro.style.display = "none";

                        // mensagem_erro.innerHTML = "Login realizado com sucesso! Redirecionando para tela de Login...";

                        // setTimeout(function () {
                        //     window.location = "./quiz.html";
                        // }, 1000); // apenas para exibir o loading

                    });

                } else {

                    console.log("Houve um erro ao tentar realizar o login");

                    cardErro.style.display = "block"
                    mensagem_erro.innerHTML = "Nenhum usuário foi encontrado";
                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
                cardErro.style.display = "block"
                mensagem_erro.innerHTML = "Nenhum usuário foi encontrado.";
            })
        }
    }
</script>